{"version":3,"file":"hover-effect.umd.js","sources":["../src/hover-effect.js"],"sourcesContent":["import * as THREE from \"three\";\nimport gsap from \"gsap\";\n\nexport default function(opts) {\n  var vertex = `\nvarying vec2 vUv;\nvoid main() {\n  vUv = uv;\n  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}\n`;\n\n  var fragment = `\nvarying vec2 vUv;\n\nuniform float dispFactor;\nuniform float dpr;\nuniform sampler2D disp;\n\nuniform sampler2D texture1;\nuniform sampler2D texture2;\nuniform float angle1;\nuniform float angle2;\nuniform float intensity1;\nuniform float intensity2;\nuniform vec4 res;\nuniform vec2 parent;\n\nmat2 getRotM(float angle) {\n  float s = sin(angle);\n  float c = cos(angle);\n  return mat2(c, -s, s, c);\n}\n\nvoid main() {\n  vec4 disp = texture2D(disp, vUv);\n  vec2 dispVec = vec2(disp.r, disp.g);\n\n  vec2 uv = 0.5 * gl_FragCoord.xy / (res.xy) ;\n  vec2 myUV = (uv - vec2(0.5))*res.zw + vec2(0.5);\n\n\n  vec2 distortedPosition1 = myUV + getRotM(angle1) * dispVec * intensity1 * dispFactor;\n  vec2 distortedPosition2 = myUV + getRotM(angle2) * dispVec * intensity2 * (1.0 - dispFactor);\n  vec4 _texture1 = texture2D(texture1, distortedPosition1);\n  vec4 _texture2 = texture2D(texture2, distortedPosition2);\n  gl_FragColor = mix(_texture1, _texture2, dispFactor);\n}\n`;\n\n  // please respect authorship and do not remove\n  console.log(\n    \"%c Hover effect by Robin Delaporte: https://github.com/robin-dela/hover-effect \",\n    \"color: #bada55; font-size: 0.8rem\"\n  );\n\n  function firstDefined() {\n    for (var i = 0; i < arguments.length; i++) {\n      if (arguments[i] !== undefined) return arguments[i];\n    }\n  }\n\n  var parent = opts.parent;\n  var dispImage = opts.displacementImage;\n  var image1 = opts.image1;\n  var image2 = opts.image2;\n  var imagesRatio = firstDefined(opts.imagesRatio, 1.0);\n  var intensity1 = firstDefined(opts.intensity1, opts.intensity, 1);\n  var intensity2 = firstDefined(opts.intensity2, opts.intensity, 1);\n  var commonAngle = firstDefined(opts.angle, Math.PI / 4); // 45 degrees by default, so grayscale images work correctly\n  var angle1 = firstDefined(opts.angle1, commonAngle);\n  var angle2 = firstDefined(opts.angle2, -commonAngle * 3);\n  var speedIn = firstDefined(opts.speedIn, opts.speed, 1.6);\n  var speedOut = firstDefined(opts.speedOut, opts.speed, 1.2);\n  var userHover = firstDefined(opts.hover, true);\n  var easing = firstDefined(opts.easing, \"expo.out\");\n  var video = firstDefined(opts.video, false);\n\n  if (!parent) {\n    console.warn(\"Parent missing\");\n    return;\n  }\n\n  if (!(image1 && image2 && dispImage)) {\n    console.warn(\"One or more images are missing\");\n    return;\n  }\n\n  var scene = new THREE.Scene();\n  var camera = new THREE.OrthographicCamera(\n    parent.offsetWidth / -2,\n    parent.offsetWidth / 2,\n    parent.offsetHeight / 2,\n    parent.offsetHeight / -2,\n    1,\n    1000\n  );\n\n  camera.position.z = 1;\n\n  var renderer = new THREE.WebGLRenderer({\n    antialias: false,\n    alpha: true\n  });\n\n  renderer.setPixelRatio(2.0);\n  renderer.setClearColor(0xffffff, 0.0);\n  renderer.setSize(parent.offsetWidth, parent.offsetHeight);\n  parent.appendChild(renderer.domElement);\n\n  var render = function() {\n    // This will be called by the TextureLoader as well as Gsap.\n    renderer.render(scene, camera);\n  };\n\n  var loader = new THREE.TextureLoader();\n  loader.crossOrigin = \"\";\n\n  var disp = loader.load(dispImage, render);\n  disp.magFilter = disp.minFilter = THREE.LinearFilter;\n\n  if (video) {\n    let frame = 0;\n    var animate = function() {\n      requestAnimationFrame(animate);\n\n      frame++; // フレーム数をインクリメント\n\n      // フレーム数が２で割り切れなければ描画しない (60fpsを30fpsにする)\n      if (frame % 2 == 0) {\n        return;\n      }\n\n      renderer.render(scene, camera);\n    };\n    animate();\n\n    var video = document.createElement(\"video\");\n    video.autoplay = true;\n    video.loop = true;\n    video.muted = true;\n    video.src = image1;\n    video.load();\n\n    var video2 = document.createElement(\"video\");\n    video2.autoplay = true;\n    video2.loop = true;\n    video2.muted = true;\n    video2.src = image2;\n    video2.load();\n\n    var texture1 = new THREE.VideoTexture(video);\n    var texture2 = new THREE.VideoTexture(video2);\n    texture1.magFilter = texture2.magFilter = THREE.LinearFilter;\n    texture1.minFilter = texture2.minFilter = THREE.LinearFilter;\n\n    video2.addEventListener(\n      \"loadeddata\",\n      function() {\n        video2.play();\n\n        texture2 = new THREE.VideoTexture(video2);\n        texture2.magFilter = THREE.LinearFilter;\n        texture2.minFilter = THREE.LinearFilter;\n\n        mat.uniforms.texture2.value = texture2;\n      },\n      false\n    );\n\n    video.addEventListener(\n      \"loadeddata\",\n      function() {\n        video.play();\n\n        texture1 = new THREE.VideoTexture(video);\n\n        texture1.magFilter = THREE.LinearFilter;\n        texture1.minFilter = THREE.LinearFilter;\n\n        mat.uniforms.texture1.value = texture1;\n      },\n      false\n    );\n  } else {\n    var texture1 = loader.load(image1, render);\n    var texture2 = loader.load(image2, render);\n\n    texture1.magFilter = texture2.magFilter = THREE.LinearFilter;\n    texture1.minFilter = texture2.minFilter = THREE.LinearFilter;\n  }\n\n  let a1, a2;\n  var imageAspect = imagesRatio;\n  if (parent.offsetHeight / parent.offsetWidth < imageAspect) {\n    a1 = 1;\n    a2 = parent.offsetHeight / parent.offsetWidth / imageAspect;\n  } else {\n    a1 = (parent.offsetWidth / parent.offsetHeight) * imageAspect;\n    a2 = 1;\n  }\n\n  var mat = new THREE.ShaderMaterial({\n    uniforms: {\n      intensity1: {\n        type: \"f\",\n        value: intensity1\n      },\n      intensity2: {\n        type: \"f\",\n        value: intensity2\n      },\n      dispFactor: {\n        type: \"f\",\n        value: 0.0\n      },\n      angle1: {\n        type: \"f\",\n        value: angle1\n      },\n      angle2: {\n        type: \"f\",\n        value: angle2\n      },\n      texture1: {\n        type: \"t\",\n        value: texture1\n      },\n      texture2: {\n        type: \"t\",\n        value: texture2\n      },\n      disp: {\n        type: \"t\",\n        value: disp\n      },\n      res: {\n        type: \"vec4\",\n        value: new THREE.Vector4(\n          parent.offsetWidth,\n          parent.offsetHeight,\n          a1,\n          a2\n        )\n      },\n      dpr: {\n        type: \"f\",\n        value: window.devicePixelRatio\n      }\n    },\n\n    vertexShader: vertex,\n    fragmentShader: fragment,\n    transparent: true,\n    opacity: 1.0\n  });\n\n  var geometry = new THREE.PlaneGeometry(\n    parent.offsetWidth,\n    parent.offsetHeight,\n    1\n  );\n  var object = new THREE.Mesh(geometry, mat);\n  scene.add(object);\n\n  function transitionIn() {\n    gsap.to(mat.uniforms.dispFactor, {\n      duration: speedIn,\n      value: 1,\n      ease: easing,\n      onUpdate: render,\n      onComplete: render\n    });\n  }\n\n  function transitionOut() {\n    gsap.to(mat.uniforms.dispFactor, {\n      duration: speedOut,\n      value: 0,\n      ease: easing,\n      onUpdate: render,\n      onComplete: render\n    });\n  }\n\n  if (userHover) {\n    parent.addEventListener(\"mouseenter\", transitionIn);\n    parent.addEventListener(\"touchstart\", transitionIn);\n    parent.addEventListener(\"mouseleave\", transitionOut);\n    parent.addEventListener(\"touchend\", transitionOut);\n  }\n\n  window.addEventListener(\"resize\", function(e) {\n    if (parent.offsetHeight / parent.offsetWidth < imageAspect) {\n      a1 = 1;\n      a2 = parent.offsetHeight / parent.offsetWidth / imageAspect;\n    } else {\n      a1 = (parent.offsetWidth / parent.offsetHeight) * imageAspect;\n      a2 = 1;\n    }\n    object.material.uniforms.res.value = new THREE.Vector4(\n      parent.offsetWidth,\n      parent.offsetHeight,\n      a1,\n      a2\n    );\n    renderer.setSize(parent.offsetWidth, parent.offsetHeight);\n\n    render();\n  });\n\n  this.next = transitionIn;\n  this.previous = transitionOut;\n}\n"],"names":["opts","firstDefined","i","arguments","length","undefined","console","log","parent","dispImage","displacementImage","image1","image2","imagesRatio","intensity1","intensity","intensity2","commonAngle","angle","Math","PI","angle1","angle2","speedIn","speed","speedOut","userHover","hover","easing","video","scene","Scene","THREE","OrthographicCamera","offsetWidth","offsetHeight","camera","position","z","renderer","WebGLRenderer","antialias","alpha","setPixelRatio","setClearColor","setSize","appendChild","domElement","render","loader","TextureLoader","crossOrigin","a1","a2","disp","load","magFilter","minFilter","LinearFilter","frame","animate","requestAnimationFrame","document","createElement","autoplay","loop","muted","src","video2","texture1","VideoTexture","texture2","addEventListener","play","mat","uniforms","value","imageAspect","ShaderMaterial","type","dispFactor","res","Vector4","dpr","window","devicePixelRatio","vertexShader","fragmentShader","transparent","opacity","geometry","PlaneGeometry","Mesh","add","object","transitionIn","transitionOut","e","material","this","next","previous","warn","gsap","to","duration","ease","onUpdate","onComplete"],"mappings":"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"}